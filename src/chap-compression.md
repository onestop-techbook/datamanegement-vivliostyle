
---
class: chapter
---


# データ圧縮の基礎

膨大なデータを効率よく扱うためには「データ圧縮」が欠かせません。データ圧縮とは、情報の内容を保ったまま、より短いビット列で表現するための技術です。圧縮によってデータ量を削減することで、保存容量の節約や通信時間の短縮、さらにはネットワーク帯域の効率的利用など、多くのメリットが得られます。ここでは、データ圧縮の基本概念について述べます。


## データ圧縮の目的と種類

データ圧縮には「可逆圧縮」と「非可逆圧縮」があります。

* **可逆圧縮（ロスレス圧縮）**

  完全に元のデータを復元できる方式です。テキスト、プログラム、ログデータなど、1ビットの欠損も許されないデータで利用されます。ZIP、PNG、LZ77、Huffman符号などが代表例です。

* **非可逆圧縮（ロッシー圧縮）**

  一部の情報を削減することで高い圧縮率を得る方式です。音声・画像・動画のように、人間の知覚特性を利用して、品質を損ねない範囲で情報を間引きます。JPEG、MP3、H.264 などがこれに該当します。

どちらの方式を使うべきかは用途によって異なります。圧縮方式を選ぶ際には、データの内容や目的を十分に理解する必要があります。そして、非可逆圧縮をかけると、当然ながら元のデータを取り戻すことはできません。

## 可逆圧縮（ロスレス圧縮）

###  簡単な可逆圧縮アルゴリズムの例：ランレングス圧縮

圧縮アルゴリズムの最も基本的な例として「ランレングス圧縮（RLE）」があります。これは、連続する同じ値を「データ」と「繰り返し回数」の組として記録する手法です。

```
元データ
AAAAAABBBCCDDDD

RLEで圧縮したデータ
A6 B3 C2 D4
```

同じ文字がまとまっているデータでは非常に高い圧縮効果があります。一方で、繰り返しが少ないデータでは、逆にデータ量が増えるという欠点もあります。つまり、**圧縮の効果はデータの性質に依存する**という事実を端的に示す例でもあります。

###  簡単な可逆圧縮アルゴリズムの例：エントロピー符号化
もう少し実用的なアルゴリズムとして、エントロピー符号化という方法があります。これは、「出現確率の高いデータに短い符号を割り当てる」というものです。

ABCの3文字からなる文字列を考えます。たとえば、ABACAACAというデータがあったとしましょう。これを0と1で表現してみます。

```
単純な方法
A:00
B:01
C:10

A B A C A A C A
0001001000001000 //16ビット必要

エントロピー符号化
出現確率　A>C>B

A:0
B:10    
C:11

A B A C A A C A
0 100 110 0 110 //11ビットで表現可能
```
ただし、一度全データをスキャンする必要があるなど、計算量と圧縮効率のバランスが必要です。

### 万能なデータ圧縮方法は存在しない

データ圧縮の世界では、「どんなデータにも常に効率よく圧縮できる万能な圧縮アルゴリズム」は存在しません。

特に、完全にランダムなデータを圧縮することはできません。

そのため、圧縮方式は「対象となるデータの特徴を利用する」という前提の上に成り立っています。テキストにはテキストの、画像には画像の、音声には音声特有のデータの偏りや規則性があり、それらを活用して初めて高い圧縮率が得られるのです。

もちろん、様々な圧縮アルゴリズムが考案されていますが、それでも、原理的に「万能な圧縮方法」というものは存在しません。


## 無限のデータ圧縮はできない

もうひとつの重要なポイントは、「無限に圧縮し続けることはできない」ということです。

もしすべてのデータを常に圧縮できる方法があると仮定すると、その圧縮を何回も繰り返すとデータ量は1ビットになります。しかしそこから元のデータを復元することはできず、矛盾が生じます。

圧縮を繰り返せば何度でも小さくできるように思えるかもしれませんが、実際には情報量（エントロピー）には下限があります。圧縮を行うほどデータはランダム性が高くなり、**完全にランダムなデータはそれ以上圧縮できない**という特性があります。

そのため、

* ZIPファイルを再びZIP圧縮してもほとんど小さくならない
* 十分圧縮されたデータは「これ以上縮まらない状態」になる
* 圧縮には必ず限界がある

という事実が生じます。

これは圧縮アルゴリズムそのものの性能ではなく、情報理論の基本的な性質によって決まるものです。

### 圧縮アルゴリズムの基本的な考え方

多くの圧縮方式は、次の二つの原則のどちらか、または両方を利用して成り立っています。

* **頻度の偏りを利用する**

頻度の高いデータには短い符号を、頻度の低いデータには長い符号を割り当てる方法です。
代表例：Huffman符号（テキストの圧縮でよく利用される）

* **パターンの再利用**

データの中に現れる繰り返しや構造を記録し、それを参照することでデータ量を減らす方法です。
代表例：LZ77（ZIP、PNGの基盤になっているアルゴリズム）

どちらの方式にも共通する特徴は、**データの中の「偏り」や「規則性」を見つけ、それを利用して短くする**という点です。

* 既知の情報を利用する

デジタルデータの圧縮という文脈とは少し離れますが、既知の情報を利用して圧縮する方法もあります。

IT系の方なら、k8sといえば、kubernetesと想像できるでしょうか。前述の圧縮アルゴリズムとは少し異なりますが、これも立派な圧縮です。文脈等から自明なワードについて、間に何文字あるかを数字で入れるという圧縮です。ただし、共通の辞書を持たない人とのやり取りには使えないので、その点は留意する必要があります。


## 非可逆圧縮

非可逆圧縮（ロッシー圧縮）は、データの一部を意図的に削減することで高い圧縮率を実現する方法です。可逆圧縮（ロスレス圧縮）がデータを完全に復元できるのに対し、非可逆圧縮では復元後のデータが元と完全には一致しません。これは「情報を削っている」ためですが、削った情報が人間の知覚にとってほとんど意味を持たないものであれば、主観的な品質を損なわずに劇的な省サイズ化が可能です。この「人間には見えづらい・聞こえづらい情報を取り除く」という原則こそが、非可逆圧縮の本質です。


現代の画像・音声・動画データは巨大です。例えば、スマートフォンで撮影した写真の生データは数十MBにもなり、非圧縮のフルHD動画なら1秒だけでも100MBを超える場合があります。
これらをそのまま保存・送信することは現実的ではありません。

そのため、非可逆圧縮によって、人間が知覚できる範囲で品質を維持しつつ、サイズを10分の1～100分の1に削減することが必要です。Web、SNS、動画配信、デジタルカメラ、音楽配信など、ほぼすべての現代メディアは非可逆圧縮の恩恵を受けています。

### JPEG：画像の非可逆圧縮

非可逆圧縮の代表例のひとつが **JPEG** です。JPEGは、写真や自然画像の圧縮に特化した方式で、画像を「人間の視覚特性に基づいて」処理します。


JPEG圧縮は、大きく次のステップで行われます。

1. **YCbCr色空間への変換**

   人間の目は明るさ（Y）には敏感で、色差（Cb/Cr）には鈍感です。そのため、色差成分の解像度を下げても見た目の劣化は少なく済みます。

2. **8×8ピクセル単位に分割**

   画像を小さなブロックに分け、各ブロックを個別に処理します。

3. **離散コサイン変換（DCT）**

   ブロック内の画像を周波数成分（低周波・高周波）に分解します。
   低周波は画像の大まかな形、高周波は細かい模様やノイズを表します。

4. **量子化（非可逆要素）**

   高周波成分を大幅に丸め（粗い値に変換し）、データを削減します。
   人間の目は高周波成分をあまり認識できないため、この操作でも画像の主観的品質は大きく損なわれません。

5. **可逆圧縮（Huffman符号化など）**

   最後に可逆圧縮を組み合わせてデータ量をさらに減らします。

JPEGの特徴は、以下に挙げられます。

* 高い圧縮率を得られる
* 写真のような自然画像に適している
* 圧縮率が高すぎるとブロックノイズが目立つ

JPEGは非可逆圧縮の典型例であり、「人間の知覚特性を理解することで非可逆圧縮が成立する」という良い例といえます。

一方で、エッジな成分の強い写真やイラストなどでは、にじみが目立ったりすることがあります。高周波をカットすることで圧縮しているため、シャープなエッジを表現することが難しいためです。処理にフーリエ変換の仲間を使っているためにこういう特性が出ます。

### MP3：音声の非可逆圧縮

音声データの非可逆圧縮には **MP3（MPEG-1 Layer 3）** が広く使われてきました。MP3 も「人間の耳には聞こえづらい音」を削って圧縮します。


MP3の基盤にあるのは「心理音響モデル」です。
人間の耳には、以下のような特性があります。

* 小さな音は、大きな音に“マスク”されて聞こえなくなる
* 周波数によって聞こえやすさに差がある
* 高い周波数の細かい成分は聞こえづらい

MP3 はこれを利用して、聞こえない・聞こえにくい成分を積極的に削除します。

処理の流れは概ね以下のとおりです。

1. **周波数への変換（MDCT：修正離散コサイン変換）**

   音声信号を時間領域から周波数領域へ変換します。

2. **心理音響モデルに基づく不要成分の削除**

   強い音に隠れて聞こえない成分を取り除きます（非可逆部分）。

3. **量子化**

   周波数ごとに適切な精度で値を丸めます。

4. **可逆圧縮（Huffman符号）**

   最後にロスレス圧縮で効率化します。

MP3の特徴も同様に

* 元の音声（PCM：waveファイル】に比べて10分の1以下のサイズまで圧縮可能
* 歌や言葉は十分な品質で保持される
* 圧縮率を上げると高音が荒れたり、金属的なノイズが出る

MP3の仕組みもまた、「人間の耳の弱点を利用して情報を削減する」という非可逆圧縮の典型例です。


### 非可逆圧縮の特徴と注意点

非可逆圧縮には多くの利点がありますが、いくつかの重要なポイントも押さえておく必要があります。

* **一度削った情報は戻らない**

非可逆圧縮によって削られた細部の情報は、復元不可能です。
JPEGを再編集して保存を繰り返すと劣化が蓄積するのはこのためです。

* **一定以上圧縮すると品質が激しく劣化する**

非可逆圧縮は「削っても目立たない部分」が存在することを前提にします。しかしその限界を超えると、不自然なノイズが現れます。

* **データの用途に応じて方法を使い分ける必要がある**

* 写真：JPEG
* 音楽：MP3 / AAC
* 動画：H.264 / HEVC

など、用途に合わせた方式が設計されています。


非可逆圧縮とは、人間の視覚・聴覚特性に基づいて「重要でない情報」を削り、劇的な圧縮率を得る技術です。JPEG や MP3 はその代表例であり、周波数成分の分解、量子化、心理モデルなどの工夫によって高い圧縮率を達成しています。今日のインターネットやマルチメディアは、これら非可逆圧縮技術なしには成立しません。
